<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>CyberQuest Admin - ××¢×¨×›×ª ××œ××”</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sidebar-bg: #1e293b; --main-bg: #f8fafc; --accent: #38bdf8; --text-main: #0f172a; --error: #ef4444; }
        body { font-family: 'Assistant', sans-serif; margin: 0; background-color: var(--main-bg); display: flex; min-height: 100vh; }
        
        /* ××¡×š ×›× ×™×¡×” */
        #loginArea { position: fixed; inset: 0; background: var(--sidebar-bg); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { background: white; padding: 40px; border-radius: 15px; text-align: center; width: 320px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3); transition: 0.3s; }
        
        /* ××¤×§×˜×™× ×œ×œ×•×’×™×Ÿ */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        .shake { animation: shake 0.2s ease-in-out 0s 2; border: 2px solid var(--error) !important; }

        /* ××‘× ×” ×›×œ×œ×™ */
        #adminContent { width: 100%; display: none; } /* ××•×¡×ª×¨ ×¢×“ ×œ×”×ª×—×‘×¨×•×ª */
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; padding: 25px; display: flex; flex-direction: column; }
        .main-panel { flex: 1; padding: 40px; overflow-y: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }

        /* ××œ×× ×˜×™× ×©×œ ×˜×¤×¡×™× */
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        button { background: var(--accent); color: var(--sidebar-bg); border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-delete { background: var(--error); color: white; width: auto; padding: 5px 10px; font-size: 0.8rem; }

        /* ×˜×‘×œ×” */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: right; padding: 12px; border-bottom: 1px solid #e2e8f0; }
        
        .cat-tag { display: inline-block; background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 6px; margin: 4px; font-size: 0.85rem; border: 1px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

<div id="loginArea">
    <div class="login-card" id="loginCard">
        <h2 style="margin-top:0">CyberQuest Admin</h2>
        <div style="position: relative;">
            <input type="password" id="adminPass" placeholder="×¡×™×¡××ª × ×™×”×•×œ">
            <span id="togglePass" onclick="togglePasswordVisibility()" style="position: absolute; left: 10px; top: 22px; cursor: pointer;">ğŸ‘ï¸</span>
        </div>
        <p id="errorMsg" style="color: var(--error); font-size: 0.8rem; display: none; margin: 5px 0;">×¡×™×¡××” ×©×’×•×™×”, × ×¡×™ ×©×•×‘.</p>
        <button onclick="login()">×›× ×™×¡×” ×œ××¢×¨×›×ª</button>
    </div>
</div>

<div id="adminContent">
    <div class="sidebar">
        <h2 style="color: var(--accent)">× ×™×”×•×œ ×¡×™×™×‘×¨</h2>
        <div class="card" style="background: rgba(255,255,255,0.05); color: white; border: none;">
            <h4>ğŸ“ ×§×˜×’×•×¨×™×•×ª</h4>
            <input id="newCatName" placeholder="×©× ×§×˜×’×•×¨×™×” ×—×“×©×”" style="background: white;">
            <button onclick="addCategory()" style="background: white; color: var(--sidebar-bg);">×”×•×¡×£</button>
            <div id="catListSidebar" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div class="main-panel">
        <h1>×œ×•×— ×‘×§×¨×” ×œ××“×¨×™×›×”</h1>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="card">
                <h2>â• ×”×•×¡×¤×ª ×©××œ×”</h2>
                <select id="qCatSelect"><option>×˜×•×¢×Ÿ ×§×˜×’×•×¨×™×•×ª...</option></select>
                <select id="qType" onchange="document.getElementById('multOptions').style.display = (this.value=='multiple'?'block':'none')">
                    <option value="open">×©××œ×” ×¤×ª×•×—×” (Flag)</option>
                    <option value="multiple">×©××œ×” ×××¨×™×§××™×ª</option>
                </select>
                <input id="qText" placeholder="×ª×•×›×Ÿ ×”×©××œ×”">
                <div id="multOptions" style="display:none">
                    <input id="opt1" placeholder="××•×¤×¦×™×” 1"><input id="opt2" placeholder="××•×¤×¦×™×” 2">
                    <input id="opt3" placeholder="××•×¤×¦×™×” 3"><input id="opt4" placeholder="××•×¤×¦×™×” 4">
                </div>
                <input id="qAns" placeholder="×”×ª×©×•×‘×” ×”× ×›×•× ×”">
                <button onclick="addQuestion()">×©××•×¨ ×©××œ×”</button>
            </div>

            <div class="card">
                <h2>ğŸ“º ×©×™×“×•×¨ ×—×™</h2>
                <p>×‘×—×¨ ×§×˜×’×•×¨×™×” ×©×ª×•×¦×’ ×œ×—× ×™×›×™× ×¢×›×©×™×•:</p>
                <select id="activeCatSelect"></select>
                <button onclick="setActive()" style="background: var(--sidebar-bg); color: white;">×”×¤×¢×œ ×©×™×“×•×¨ ×œ×§×˜×’×•×¨×™×” ×–×•</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ“š ×××’×¨ ×”×©××œ×•×ª ×©×œ×š</h2>
            <table>
                <thead><tr><th>×§×˜×’×•×¨×™×”</th><th>×©××œ×”</th><th>×ª×©×•×‘×”</th><th>×¤×¢×•×œ×”</th></tr></thead>
                <tbody id="questionsTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // ×”×’×“×¨×•×ª - ×—×•×‘×” ×œ×”×—×œ×™×£ ×‘-URL ×©×œ×š ×-Firebase!
    const BASE_URL = "https://osint-751d7-default-rtdb.europe-west1.firebasedatabase.app/"; 
    const MASTER_PASSWORD = "zigi2026";

    // ×œ×•×’×™×§×” ×©×œ ×›× ×™×¡×”
    function togglePasswordVisibility() {
        const p = document.getElementById('adminPass');
        const t = document.getElementById('togglePass');
        p.type = p.type === 'password' ? 'text' : 'password';
        t.innerText = p.type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ”’';
    }

    function login() {
        const pass = document.getElementById('adminPass').value;
        const card = document.getElementById('loginCard');
        if (pass === MASTER_PASSWORD) {
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('adminContent').style.display = 'flex';
            loadData();
        } else {
            card.classList.add('shake');
            document.getElementById('errorMsg').style.display = 'block';
            setTimeout(() => card.classList.remove('shake'), 500);
        }
    }

    // × ×™×”×•×œ × ×ª×•× ×™×
    async function loadData() {
        const cRes = await fetch(`${BASE_URL}categories.json`);
        const cData = await cRes.json();
        const qCat = document.getElementById('qCatSelect');
        const aCat = document.getElementById('activeCatSelect');
        const side = document.getElementById('catListSidebar');
        
        qCat.innerHTML = ""; aCat.innerHTML = ""; side.innerHTML = "";
        for (let id in cData) {
            const name = cData[id].name;
            qCat.innerHTML += `<option value="${name}">${name}</option>`;
            aCat.innerHTML += `<option value="${name}">${name}</option>`;
            side.innerHTML += `<div class="cat-tag">${name} <span style="cursor:pointer" onclick="deleteItem('categories/${id}')">Ã—</span></div>`;
        }

        const qRes = await fetch(`${BASE_URL}questions.json`);
        const qData = await qRes.json();
        const tbody = document.getElementById('questionsTable');
        tbody.innerHTML = "";
        for (let id in qData) {
            tbody.innerHTML += `<tr>
                <td><b>${qData[id].category}</b></td>
                <td>${qData[id].text}</td>
                <td><code>${qData[id].answer}</code></td>
                <td><button class="btn-delete" onclick="deleteItem('questions/${id}')">××—×§</button></td>
            </tr>`;
        }
    }

    async function addCategory() {
        const name = document.getElementById('newCatName').value.trim();
        if(!name) return;
        await fetch(`${BASE_URL}categories.json`, { method: 'POST', body: JSON.stringify({name}) });
        document.getElementById('newCatName').value = "";
        loadData();
    }

    async function addQuestion() {
        const type = document.getElementById('qType').value;
        const data = {
            category: document.getElementById('qCatSelect').value,
            type: type,
            text: document.getElementById('qText').value,
            answer: document.getElementById('qAns').value.trim()
        };
        if(type === 'multiple') {
            data.options = [document.getElementById('opt1').value, document.getElementById('opt2').value, 
                            document.getElementById('opt3').value, document.getElementById('opt4').value];
        }
        await fetch(`${BASE_URL}questions.json`, { method: 'POST', body: JSON.stringify(data) });
        loadData();
    }

    async function setActive() {
        const cat = document.getElementById('activeCatSelect').value;
        await fetch(`${BASE_URL}settings.json`, { method: 'PUT', body: JSON.stringify({activeCategory: cat}) });
        alert("×©×™×“×•×¨ ×¢×•×“×›×Ÿ ×œ×§×˜×’×•×¨×™×”: " + cat);
    }

    async function deleteItem(path) {
        if(confirm("×œ××—×•×§ ×¤×¨×™×˜ ×–×”?")) {
            await fetch(`${BASE_URL}${path}.json`, { method: 'DELETE' });
            loadData();
        }
    }
</script>
</body>
</html>
